---
import { getCollection } from 'astro:content';
import PostNavigation from '../components/astro/PostNavigation.astro';
import Prose from '../layouts/Prose.astro';

const { frontmatter, collection, slug } = Astro.props;
const { title, date, tags } = frontmatter;

const allPosts = (await getCollection(collection)).map((p) => ({
  slug: p.slug,
  title: p.data.title,
  date: new Date(p.data.date),
})).sort((a, b) => b.date.getTime() - a.date.getTime());

const currentIndex = allPosts.findIndex(post => post.slug === slug);
// const current = allPosts[currentIndex];
const prev = allPosts[currentIndex + 1];
const next = allPosts[currentIndex - 1];
---

<article class="content mx-auto px-4 py-8 max-w-3xl" data-pagefind-body>
  <header class="mb-6">
    <h2 class="text-3xl font-bold mb-2 break-words">{title}</h2>
    <p class="text-sm text-gray-500">{new Date(date).toLocaleDateString()}</p>
    {tags && (
      <ul class="flex flex-wrap gap-2 mt-2">
        {tags.map(tag => (
          <li class="text-xs bg-gray-200 rounded px-2 py-1">{tag}</li>
        ))}
      </ul>
    )}
  </header>

  <Prose>
    <slot />
  </Prose>
  <PostNavigation 
    collection={collection}
    prev={prev ? { slug: prev.slug, title: prev.title } : undefined}
    next={next ? { slug: next.slug, title: next.title } : undefined}
  />
</article>

